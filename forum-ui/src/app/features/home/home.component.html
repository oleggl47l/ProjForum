<div class="home-container">
  <!-- Заголовок по центру страницы -->
  <div class="centered-header">
    <div class="header-content">
      <h1 tuiTitle size="xl" class="main-title">
        Полифорум
      </h1>
      <p class="header-subtitle"> </p>
      <p class="header-subtitle">Обсуждайте, делитесь, вдохновляйтесь</p>
    </div>
  </div>

  <!-- Хедер с навигацией -->
  <div class="page-header">
    <div class="header-nav">
      <div class="nav-right">
        <button
          tuiButton
          size="m"
          appearance="flat"
          routerLink="/login"
          class="auth-btn"
          type="button"
          aria-label="Войти в аккаунт"
        >
          Войти
        </button>
        <button
          tuiButton
          size="m"
          appearance="primary"
          routerLink="/profile"
          class="auth-btn profile-btn"
          type="button"
          aria-label="Перейти в профиль"
        >
          Профиль
        </button>
      </div>
    </div>
  </div>

  <!-- Основной контент -->
  <div class="main-content">
    <!-- Панель поиска и создания -->
    <div class="actions-panel">
      <div class="search-container">
        <input
          type="search"
          [(ngModel)]="searchQuery"
          (ngModelChange)="applyFilters()"
          placeholder="Поиск постов..."
          class="search-input"
          aria-label="Поиск постов"
        />
        @if (searchQuery) {
          <button
            class="clear-search"
            (click)="searchQuery = ''; applyFilters()"
            aria-label="Очистить поиск"
            type="button"
          >
            ×
          </button>
        }
      </div>

      <button
        tuiButton
        size="m"
        appearance="primary"
        (click)="openCreatePostDialog()"
        class="create-post-btn create-post-btn--highlighted"
        aria-label="Создать новый пост"
        type="button"
      >
        Создать пост
      </button>
    </div>

    <!-- Компактный фильтр по тегам -->
    @if (tags.length > 0) {
      <div class="tags-filter-section">
        <div class="tags-header">
          <h3 tuiTitle size="s" style="margin: 0;">Теги:</h3>
        </div>
        <div class="tags-cloud" role="group" aria-labelledby="tags-title">
          @for (tag of tags; track tag.id) {
            <button
              tuiBadge
              [appearance]="selectedTags.includes(tag.name || '') ? 'primary' : 'secondary'"
              (click)="toggleTagFilter(tag.name || '')"
              class="tag-filter-btn"
              [attr.aria-pressed]="selectedTags.includes(tag.name || '')"
              type="button"
              role="check-box"
            >
              {{ tag.name }}
            </button>
          }
        </div>
      </div>
    }

    <!-- Список постов -->
    <div class="posts-section">
      <div class="section-header">
        <h2 tuiTitle size="m" class="section-subtitle">Посты сообщества</h2>
        <div class="posts-count" aria-live="polite" aria-atomic="true">
          Показано {{ filteredPosts.length }} из {{ posts.length }}
        </div>
      </div>

      @if (isLoading) {
        <div class="loading-state" aria-live="polite" aria-busy="true">
          <tui-loader size="l" aria-label="Загрузка постов"></tui-loader>
          <p>Загрузка постов...</p>
        </div>
      } @else if (posts.length === 0) {
        <div class="empty-state" role="alert">
          <h3 tuiTitle size="s">Постов не найдено</h3>
          <p>Попробуйте изменить параметры фильтрации</p>
          <button
            tuiButton
            size="m"
            appearance="outline"
            (click)="clearFilters()"
            type="button"
            aria-label="Сбросить все фильтры"
          >
            Сбросить фильтры
          </button>
        </div>
      } @else {
        <!-- Список постов -->
        <div class="posts-list" role="list" aria-label="Список постов">
          @for (post of filteredPosts; track post.id; let i = $index) {
            <article
              class="post-card-wrapper"
              role="listitem"
              [attr.aria-posinset]="i + 1"
              [attr.aria-setsize]="filteredPosts.length"
            >
              <a
                [routerLink]="['/post', post.id]"
                class="post-link"
                [attr.aria-label]="'Пост: ' + (post.title || '')"
              >
                <div class="post-card" [class.draft]="!post.isPublished">
                  <!-- Заголовок поста -->
                  <div class="post-header">
                    <div class="post-meta">
                      <div class="author-info">
                        <tui-avatar size="s" aria-hidden="true">
                          {{ post.authorId?.substring(0, 2) || 'AU' }}
                        </tui-avatar>
                        <div class="author-details">
                          <span class="author-id">Пользователь {{ post.authorId?.substring(0, 8) }}</span>
                          <span class="post-date">
                            {{ formatDate(post.createdAt) }}
                          </span>
                        </div>
                      </div>
                    </div>

                    @if (post.category) {
                      <div
                        class="category-badge"
                        aria-label="Категория: {{ post.category }}"
                      >
                        {{ post.category }}
                      </div>
                    }
                  </div>

                  <!-- Контент поста -->
                  <div class="post-body">
                    <h3 class="post-title">
                      {{ post.title }}
                      @if (!post.isPublished) {
                        <tui-badge
                          appearance="warning"
                          size="s"
                          class="draft-badge"
                          aria-label="Черновик"
                        >
                          Черновик
                        </tui-badge>
                      }
                    </h3>

                    <p class="post-excerpt">
                      {{ getPostExcerpt(post.content || '') }}
                    </p>

                    @if (post.tagNames && post.tagNames.length > 0) {
                      <div class="post-tags" role="group" aria-label="Теги поста">
                        @for (tag of post.tagNames; track tag) {
                          <span class="post-tag">
                            {{ tag }}
                          </span>
                        }
                      </div>
                    }
                  </div>

                  <!-- Футер поста -->
                  <div class="post-footer">
                    <div class="post-stats">
                      <span
                        tuiHint="Просмотры"
                        tuiHintDirection="top"
                        class="stat"
                        tabindex="0"
                        role="tooltip"
                      >
                        0 просмотров
                      </span>
                      <span
                        tuiHint="Комментарии"
                        tuiHintDirection="top"
                        class="stat"
                        tabindex="0"
                        role="tooltip"
                      >
                        0 комментариев
                      </span>
                    </div>
                  </div>
                </div>
              </a>
            </article>
          }
        </div>

        <!-- Пагинация -->
        @if (totalPages > 1) {
          <div class="pagination-wrapper" aria-label="Навигация по страницам">
            <tui-pagination
              [length]="totalPages"
              [(index)]="currentPage"
              class="pagination"
              aria-label="Пагинация"
            ></tui-pagination>
          </div>
        }
      }
    </div>
  </div>

  <!-- Диалог создания поста -->
  <app-create-post-dialog
    [open]="isCreatePostDialogOpen"
    (closed)="closeCreatePostDialog()"
    (postCreated)="onPostCreated()"
  ></app-create-post-dialog>
</div>
